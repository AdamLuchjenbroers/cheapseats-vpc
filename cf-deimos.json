{
  "AWSTemplateFormatVersion": "2010-09-09",

  "Description" : "Core Deimos VPC and IAM Infrastructure",
  
  "Parameters" : {
    "AwsCIDRRange" : {
      "Type" : "String",
      "Description" : "CIDR Range for AWS Resources"
    },
    "VpnCIDRRange" : {
      "Type" : "String",
      "Description" : "CIDR Range for Incoming VPN Connectivity"
    }
  },
  
  "Resources" : {
    "DeimosVpc" : {
      "Type" : "AWS::EC2::VPC",
      "Properties" : {
        "CidrBlock" : { "Ref" : "AwsCIDRRange" },
        "EnableDnsSupport" : true,
        "Tags" : [
          { "Key" : "Name", "Value" : "DeimosVPC" }
        ]       
      }
    },
    
    "PublicSubnetA" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
        "VpcId" : { "Ref" : "DeimosVpc" },
        "CidrBlock" : "192.168.128.0/24" ,
        "AvailabilityZone" : { "Fn::Select" : [ 0 , { "Fn::GetAZs" : { "Ref" : "AWS::Region" } } ] },
        "Tags" : [
          { "Key" : "Name", "Value" : "PublicSubnet-A" },
          { "Key" : "RoutingType", "Value" : "Public" },
          { "Key" : "MappedCidr", "Value" : {"Fn::Select" : [ 0, { "Fn::Cidr" : [ { "Ref" : "AwsCIDRRange"}, "6", "8" ] } ] } }
        ]
      }
    }
  },
  
  "Outputs" : {
    "DeimosVpcId" : {
      "Description" : "VPC ID of Deimos VPC",
      "Value" : { "Ref" : "DeimosVpc" },
      "Export" : {
        "Name" : "Deimos-VPCID"
      }
    }
  }
}
    
