version: 0.2

env:
  variables:
    PACKAGE_PREFIX: "Packages/DeimosCore"
    KMS_S3KEY: "aws/s3"

phases:
  install:
    runtime-versions:
      python: 3.7
    commands:

      # Upgrade AWS CLI to the latest version
      - pip install --upgrade awscli
  build: 
    commands:
      - echo Upload Target $PACKAGE_BUCKET to $PACKAGE_PREFIX
      - aws cloudformation package --template-file cf-deimos.json --s3-bucket $PACKAGE_BUCKET --s3-prefix $PACKAGE_PREFIX --kms-key-id $KMS_S3KEY --output-template-file cf-deimos-packed.json
artifacts:
  secondary-artifacts:
    DeimosCloudFormation:
      base-directory: ./
      files:
        - cf-deimos-packed.json
    DeimosResources:
      base-directory: Resources
      files:
        - '**/*'
        
    
